<!doctype html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>IMQ Inference Demo</title>
    <style>
      body { font-family: system-ui, sans-serif; max-width: 900px; margin: 40px auto; padding: 0 16px; }
      textarea { width: 100%; height: 120px; }
      pre { white-space: pre-wrap; background: #111; color: #eee; padding: 12px; border-radius: 10px; }
      .row { display: flex; gap: 10px; align-items: center; }
      button { padding: 10px 14px; }
      small { color: #666; }
    </style>
  </head>
  <body>
    <h1>Inference Demo: Llama 3.1 8B Instruct - 4-bit IMQ quantized</h1>
    <p><small>OpenAI-compatible endpoint behind the scenes: <code>/v1/chat/completions</code></small></p>

    <textarea id="prompt">Explain in 3-5 sentences: The future of artificial intelligence is...</textarea>
    <div class="row">
      <button onclick="send()">Generate</button>
      <label>max_tokens <input id="max_tokens" type="number" value="256" min="1" max="2048"/></label>
      <label>temperature <input id="temp" type="number" value="0.7" step="0.1" min="0" max="2"/></label>
    </div>

    <h3>Output</h3>
    <pre id="out"></pre>

    <script>
      async function send() {
        const out = document.getElementById("out");
        out.textContent = "Generating Response ...";

        const prompt = document.getElementById("prompt").value;
        const max_tokens = parseInt(document.getElementById("max_tokens").value, 10);
        const temperature = parseFloat(document.getElementById("temp").value);

        const payload = {
          messages: [{ role: "user", content: prompt }],
          max_tokens,
          temperature
        };

        const res = await fetch("https://dzl4twil8fctt0zm.us-east-1.aws.endpoints.huggingface.cloud/v1/chat/completions", {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
            // If you enforce auth, paste token here or remove server-side requirement.
            // "Authorization": "Bearer YOUR_TOKEN"
          },
          body: JSON.stringify(payload)
        });

        const data = await res.json();
        if (!res.ok) {
          out.textContent = JSON.stringify(data, null, 2);
          return;
        }
        const text = data.choices?.[0]?.message?.content;
        const tps  = data.decode_tps;

        out.textContent =
        (text ?? JSON.stringify(data, null, 2)) +
        (tps != null ? `\n\n---\nTokens per second: ${tps}` : "");
      }
    </script>
  </body>
</html>